function eventBeforeOpenModel__viewer(e){var t=[],n="."+e.classPicked+"."+e.classCellHasEvent;$(n).each(function(n,a){t.push($(a).attr(e.attributeDate))}),$("."+e.classPicked).removeClass(e.classPicked);var a=e.selector.getAttribute("data-employer"),d=e.selector.getAttribute("data-sitter");if(a&&d){var o=formatZeroBefore(e.selectYear),r=formatZeroBefore(parseInt(e.selectMonth)+1),i=e.data[o][r],l=t.map(function(e){return i[formatZeroBefore(e)].type})[0];if(1==l){var c="ベビーシッター："+SYSTEM_TEXT_SALARY_SITTER+" / 1時間";document.getElementById(e.idModalTextTime).innerHTML=c}else if(2==l){c="家事代行："+SYSTEM_TEXT_SALARY_HOUSE+" / 1時間";document.getElementById(e.idModalTextTime).innerHTML=c}}return t}function showProress(e){if(hideProress(),e){var t=document.createElement("div");t.id="js-dom-temp-proress",t.className="progress progress-success";var n=document.createElement("div");n.className="progress-loadding",t.appendChild(n),e.appendChild(t)}}function hideProress(){document.getElementById("js-dom-temp-proress")&&document.getElementById("js-dom-temp-proress").remove()}function eventAfterOpenModel__viewer(e,t){document.getElementById(e.idModalButtonTimeClose).onclick=function(t){t.preventDefault(),$("."+e.classPicked).removeClass(e.classPicked),e.modelClose()},$(".time-close").each(function(){this.onclick=function(t){t.preventDefault(),$("."+e.classPicked).removeClass(e.classPicked),e.modelClose()}}),document.getElementById(e.idModalBooking).onclick=function(n){if(this.classList.contains("goto-login")||this.classList.contains("disabled"))return!0;n.preventDefault(),document.getElementById(e.idModalBooking)&&showProress(document.getElementById(e.idModalBooking));var a=e.selector.getAttribute("data-employer"),d=e.selector.getAttribute("data-sitter"),o=e.selector.getAttribute("data-refesh"),r=document.getElementById(e.idBookingBeginTime).value,i=document.getElementById(e.idBookingEndTime).value,l=formatZeroBefore(e.selectYear),c=formatZeroBefore(parseInt(e.selectMonth)+1),m=formatZeroBefore(t[0]),s=e.data[l][c][m].type;if(a&&d){var u=l+"-"+c+"-"+m,p="こんにちは、あなたと一緒に仕事をスケジュールしたいと思います\n 日："+u+" \n 開始時間："+r+" \n 終了時間："+i,v={};return v.localUserId=parseInt(a),v.referenceUserId=parseInt(d),v.refesh=o,v.message=p,v.date=u,v.type=s,v.salary=1==s?SYSTEM_TEXT_SALARY_SITTER:SYSTEM_TEXT_SALARY_HOUSE,v.timeBegin=r?r+":00":"00:00:00",v.timeEnd=i?i+":00":"01:00:00",fetch(SYSTEM_REAL_TIME_URL+"/api/channel",{method:"POST",body:JSON.stringify(v),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200!=e.code)throw Error("error");SYSTEM_CHAT_EMPLOYER;"undefined"!=typeof ID_VIEW_SITTER&&ID_VIEW_SITTER,window.location.replace(SYSTEM_CHAT_EMPLOYER)}).catch(e=>(setTimeout(function(){hideProress()},1e3),alert("エラーがあります。ページを更新するか、管理者に連絡してください"),!1))}}}function createModelCalendar__viewer(e){var t=document.createElement("div");t.className=e.classModal+" d-none",t.id=e.idModalCalendar;var n=document.createElement("div");n.className=e.classModalHeader,n.id=e.classModalHeader;var a=document.createElement("span");a.id=e.idModalTextTime,n.appendChild(a);var d=document.createElement("button");return d.id=e.idModalButtonTimeClose,d.className="time-close",d.innerHTML="x",n.appendChild(d),t.appendChild(n),t=e.selector.getAttribute("data-employer")&&e.selector.getAttribute("data-sitter")?createButtonModelCalendarSettimeBooking__viewer(t,e):createButtonModelCalendarLoginNoti__viewer(t,e)}function createButtonModelCalendarSettimeBooking__viewer(e,t){var n=document.createElement("div");n.className=t.classModalBody,e.appendChild(n);var a=document.createElement("div");a.id=t.idWrapperViewerChange,a.className=t.idWrapperViewerChange;var d=document.createElement("input");d.id=t.idBookingBeginTime,d.onblur=function(){return validateTimeSetterBooking(t)},a.appendChild(d);var o=document.createElement("input");o.id=t.idBookingEndTime,o.onblur=function(){return validateTimeSetterBooking(t)},a.appendChild(o),$(d).timepicker({timeFormat:"H:i"}),$(o).timepicker({timeFormat:"H:i"}),e.appendChild(a);var r=document.createElement("div");r.className="wrapper-button";var i=document.createElement("button");i.id="close-model",i.className="time-close",i.innerHTML="キャンセル",r.appendChild(i);var l=document.createElement("button");return l.id=t.idModalBooking,l.className="booking disabled",l.innerHTML="チャットする",r.appendChild(l),e.appendChild(r),e}function validateTimeSetterBooking(e){checkTimeSetterBookingValid(e).then(t=>{if(!t)throw Error("終了時間は開始時間より後でなければなりません。");return showErrorResultSetterBooking(e,0)}).catch(t=>showErrorResultSetterBooking(e,t.message))}function showErrorResultSetterBooking(e,t){var n=document.getElementById(e.idWrapperViewerChange);if($(n).find(".error").remove(),!t)return document.getElementById(e.idModalBooking).classList.remove("disabled"),!1;var a=document.createElement("p");return a.className="error",a.innerHTML=t,n.appendChild(a),document.getElementById(e.idModalBooking).classList.add("disabled"),!0}async function checkTimeSetterBookingValid(e){var t=document.getElementById(e.idBookingBeginTime),n=document.getElementById(e.idBookingEndTime);if(!t||!n)throw Error("input not found");if(!t.value)throw Error("開始時間が必要です");if(!n.value)throw Error("終了時間が必要です");var a=parseInt(t.value.split(":").join(""))||0;if(valEnd=parseInt(n.value.split(":").join(""))||0,t.value&&n.value&&a<valEnd)return!0;throw Error("終了時間は開始時間より後でなければなりません。")}function createButtonModelCalendarLoginNoti__viewer(e,t){var n=document.createElement("div");n.className=t.classModalBody,n.innerHTML="利用者ログインを行ってから再度日程を指定してください。",e.appendChild(n);var a=document.createElement("div");a.className="wrapper-button";var d=document.createElement("a");return d.id=t.idModalBooking,d.className="goto-login",d.href="/employer/login/VIEW_SITTER/"+ID_VIEW_SITTER,d.innerHTML="利用者ログイン",a.appendChild(d),e.appendChild(a),e}function eventBeforeOpenModel__selector(e){var t=[],n="."+e.classPicked;return $(n).each(function(n,a){t.push($(a).attr(e.attributeDate))}),t}function eventAfterOpenModel__selector(e,t){document.getElementById(e.idModalButtonNew).onclick=function(n){n.preventDefault();var a=document.getElementById(e.idModalHourBegin),d=document.getElementById(e.idModalMinuteBegin),o=document.getElementById(e.idModalHourEnd),r=document.getElementById(e.idModalMinuteEnd),i=document.getElementById(e.idModalCheckFirst).checked?1:2;n={start:e.formatZeroBefore(a.value)+":"+e.formatZeroBefore(d.value),finish:e.formatZeroBefore(o.value)+":"+e.formatZeroBefore(r.value),overnight:0,status:0,type:i,class:"event-new type-job"+i};validateEvent()&&(e.overrideEvent(t,n),$("."+e.classPicked).removeClass(e.classPicked),e.modelClose(),$("#js-event-data").valid())},document.getElementById(e.idModalButtonEdit).onclick=function(n){n.preventDefault(),console.log("vaof edit");var a=document.getElementById(e.idModalHourBegin),d=document.getElementById(e.idModalMinuteBegin),o=document.getElementById(e.idModalHourEnd),r=document.getElementById(e.idModalMinuteEnd),i=document.getElementById(e.idModalCheckFirst).checked?1:2;n={start:e.formatZeroBefore(a.value)+":"+e.formatZeroBefore(d.value),finish:e.formatZeroBefore(o.value)+":"+e.formatZeroBefore(r.value),overnight:0,status:0,type:i,class:"event-update type-job"+i};validateEvent()&&(e.updateEvent(t[0],n),$("."+e.classPicked).removeClass(e.classPicked),e.modelClose(),$("#js-event-data").valid())},document.getElementById(e.idModalButtonDelete).onclick=function(n){n.preventDefault(),e.deleteEvent(t[0]),$("."+e.classPicked).removeClass(e.classPicked),e.modelClose(),$("#js-event-data").valid()},document.getElementById(e.idModalButtonTimeClose).onclick=function(t){t.preventDefault(),$("."+e.classPicked).removeClass(e.classPicked),e.modelClose(),$("#js-event-data").valid(),$("#check-time").valid()}}function createModelCalendar__selector(e){var t=document.createElement("div");t.className=e.classModal+" d-none",t.id=e.idModalCalendar;var n=document.createElement("div");n.className=e.classModalHeader;var a=document.createElement("span");a.id=e.idModalTextTime,a.innerHTML="00月00日(火)",n.appendChild(a);var d=document.createElement("button");d.id=e.idModalButtonTimeClose,d.className="time-close",d.innerHTML="x",n.appendChild(d),t.appendChild(n);var o=document.createElement("div");o.className=e.classModalBody;var r=document.createElement("div");r.className=e.wrapperInput;var i=document.createElement("INPUT");i.id=e.idModalHourBegin,i.name=e.nameModalHourBegin,i.type=e.typeNumber,i.min=0,i.max=23;var l=document.createElement("span");l.innerHTML="：";var c=document.createElement("INPUT");c.id=e.idModalMinuteBegin,c.name=e.nameModalMinuteBegin,c.type=e.typeNumber,c.min=0,c.max=59;var m=document.createElement("span");m.innerHTML="～";var s=document.createElement("INPUT");s.id=e.idModalHourEnd,s.name=e.nameModalHourEnd,s.type=e.typeNumber,s.min=0,s.max=23;var u=document.createElement("span");u.innerHTML="：";var p=document.createElement("INPUT");p.id=e.idModalMinuteEnd,p.name=e.nameModalMinuteEnd,p.type=e.typeNumber,p.min=0,p.max=59,r.appendChild(i),r.appendChild(l),r.appendChild(c),r.appendChild(m),r.appendChild(s),r.appendChild(u),r.appendChild(p),o.appendChild(r);var v=createCheckboxJobTypeModel(e);o.appendChild(v),t.appendChild(o);var E=document.createElement("div");E.className="wrapper-button";var f=document.createElement("button");f.id=e.idModalButtonNew,f.innerHTML="登録する";var B=document.createElement("button");B.id=e.idModalButtonEdit,B.innerHTML="編集する";var h=document.createElement("button");return h.id=e.idModalButtonDelete,h.innerHTML="削除する",E.appendChild(f),E.appendChild(B),E.appendChild(h),t.appendChild(E),t}function createCheckboxJobTypeModel(e){var t=document.createElement("div");t.className=e.wrapperCheckBox;var n=document.createElement("INPUT");n.id=e.idModalCheckFirst,n.onchange=function(){calendarModelCheckboxChangeStatus(e,this)},n.setAttribute("type","checkbox"),n.setAttribute("name",e.idModalCheckFirst);var a=document.createElement("LABEL");a.innerHTML="ベビーシッター",a.htmlFor=e.idModalCheckFirst;var d=document.createElement("INPUT");d.id=e.idModalCheckLast,d.onchange=function(){calendarModelCheckboxChangeStatus(e,this)},d.setAttribute("type","checkbox"),d.setAttribute("name",e.idModalCheckLast);var o=document.createElement("LABEL");return o.innerHTML="家事代行",o.htmlFor=e.idModalCheckLast,t.appendChild(n),t.appendChild(a),t.appendChild(d),t.appendChild(o),t}function calendarModelCheckboxChangeStatus(e,t){var n=document.getElementById(e.idModalCheckFirst),a=document.getElementById(e.idModalCheckLast);n.checked&&a.checked&&(t.checked&&t.getAttribute("id")==e.idModalCheckFirst?a.click():n.click())}function validateEvent(){return console.log("validateEventvalidateEventvalidateEventvalidateEvent",checkValidTime()&&checkValidJobType()),checkValidTime()&&checkValidJobType()}function checkValidJobType(){var e=document.getElementById("js-modal-check-first"),t=document.getElementById("js-modal-check-last");return e.checked||t.checked}function checkValidTime(){var e=!1,t=$("#js-hour-begin").val().trim().trim(),n=$("#js-minute-begin").val().trim(),a=$("#js-hour-end").val().trim(),d=$("#js-minute-end").val().trim(),o=formatZeroBefore(t)+":"+formatZeroBefore(n)+":00",r=formatZeroBefore(a)+":"+formatZeroBefore(d)+":00";if(validateTime(o)&&validateTime(r)){var i=formatZeroBefore(t)+""+formatZeroBefore(n);e=formatZeroBefore(a)+""+formatZeroBefore(d)>i}return e}function validateTime(e){return/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test(e)}function convertNumberJP(e){return e.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})}function formatZeroBefore(e){return e=parseInt(e),isNaN(e)?"00":(e<10&&(e="0"+e),e)}$(document).ready(function(){var e=document.getElementById("mypage-sitter");if(document.getElementById("data")&&e){var t=document.getElementById("draw-calendar"),n=document.getElementById("js-event-data"),a=document.getElementById("data").innerHTML;if(t)(d=new Calendar).setNewCalendarSelector(!0),d.setEventData(JSON.parse(a)),d.setElementDraw(t),d.draw()}e=document.getElementById("sitter-mypage-edit");if(document.getElementById("data")&&e){t=document.getElementById("draw-calendar"),n=document.getElementById("js-event-data"),a=document.getElementById("js-event-data").value;if(t)(d=new Calendar).setNewCalendarSelector(!0),d.setEventData(JSON.parse(a)),d.setElementDraw(t),d.setInputEventData(n),d.setBeforeOpenModel(eventBeforeOpenModel__selector),d.setAfterOpenModel(eventAfterOpenModel__selector),d.setCreateModel(createModelCalendar__selector),d.draw()}if(document.getElementById("view-sitter-page")){var d;t=document.getElementById("draw-calendar"),n=document.getElementById("js-event-data");if(a=document.getElementById("data").innerHTML,t)(d=new Calendar).setPickDrag(!1),d.setEventData(JSON.parse(a)),d.setElementDraw(t),d.setInputEventData(n),d.setBeforeOpenModel(eventBeforeOpenModel__viewer),d.setAfterOpenModel(eventAfterOpenModel__viewer),d.setCreateModel(createModelCalendar__viewer),d.draw()}});